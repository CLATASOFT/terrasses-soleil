<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>â˜€ï¸ Terrasses Soleil â€” RequÃªtes Live</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    /* â”€â”€ Reset & base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }

    body {
      font-family: 'Roboto', sans-serif;
      background: #1a1a2e;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      height: 100dvh;
    }

    /* â”€â”€ Top nav â€” matches app exactly â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .nav {
      background: #0f0f1a;
      border-bottom: 1px solid rgba(255, 180, 0, 0.2);
      padding: 0 16px;
      display: flex;
      align-items: center;
      gap: 14px;
      height: 52px;
      flex-shrink: 0;
      position: relative;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Oswald', sans-serif;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.06em;
      color: #ffd700;
      text-transform: uppercase;
    }

    .nav-sun {
      font-size: 20px;
      line-height: 1;
      filter: drop-shadow(0 0 6px rgba(255, 215, 0, 0.7));
      animation: rotateSun 20s linear infinite;
    }

    @keyframes rotateSun {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    .nav-time {
      margin-left: auto;
      font-family: 'Roboto Mono', monospace;
      font-size: 15px;
      color: #ffd700;
      letter-spacing: 0.04em;
    }

    .nav-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 8px #22c55e;
      animation: livePulse 1.6s ease-in-out infinite;
    }

    @keyframes livePulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(0.8); }
    }

    /* â”€â”€ Tab bar â€” matches app nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tabs {
      background: #0f0f1a;
      border-bottom: 1px solid rgba(255, 180, 0, 0.15);
      display: flex;
      flex-shrink: 0;
    }

    .tab {
      flex: 1;
      padding: 10px 4px 9px;
      text-align: center;
      font-family: 'Oswald', sans-serif;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.06em;
      color: rgba(255,255,255,0.35);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      user-select: none;
      text-transform: uppercase;
    }

    .tab.active {
      color: #ffd700;
      border-bottom-color: #ffd700;
    }

    .tab-icon { font-size: 14px; display: block; margin-bottom: 2px; }

    /* â”€â”€ Stats strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-strip {
      background: #111125;
      border-bottom: 1px solid rgba(255,180,0,0.1);
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      flex-shrink: 0;
    }

    .stat-cell {
      padding: 9px 6px 8px;
      text-align: center;
      border-right: 1px solid rgba(255,255,255,0.05);
    }
    .stat-cell:last-child { border-right: none; }

    .stat-val {
      font-family: 'Oswald', sans-serif;
      font-size: 20px;
      font-weight: 600;
      color: #ffd700;
      line-height: 1;
      letter-spacing: 0.02em;
    }

    .stat-label {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      color: rgba(255,255,255,0.3);
      letter-spacing: 0.08em;
      margin-top: 3px;
      text-transform: uppercase;
    }

    /* â”€â”€ Type breakdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .type-bar {
      background: #0d0d1f;
      border-bottom: 1px solid rgba(255,180,0,0.08);
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      flex-shrink: 0;
    }

    .type-cell {
      padding: 7px 4px 6px;
      text-align: center;
      border-right: 1px solid rgba(255,255,255,0.04);
      cursor: pointer;
      transition: background 0.15s;
    }
    .type-cell:last-child { border-right: none; }
    .type-cell:hover { background: rgba(255,215,0,0.04); }
    .type-cell.active-filter { background: rgba(255,215,0,0.07); }

    .type-pill-name {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .type-pill-count {
      font-family: 'Oswald', sans-serif;
      font-size: 15px;
      font-weight: 600;
      margin-top: 2px;
      color: #fff;
    }

    /* â”€â”€ Column header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .col-header {
      background: #0a0a18;
      border-bottom: 1px solid rgba(255,180,0,0.08);
      padding: 6px 14px;
      display: grid;
      grid-template-columns: 130px 1fr 90px 48px;
      gap: 10px;
      flex-shrink: 0;
    }

    .col-h {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      font-weight: 500;
      letter-spacing: 0.1em;
      color: rgba(255,255,255,0.25);
      text-transform: uppercase;
    }

    /* â”€â”€ Feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .feed {
      flex: 1;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .feed::-webkit-scrollbar { width: 3px; }
    .feed::-webkit-scrollbar-track { background: transparent; }
    .feed::-webkit-scrollbar-thumb { background: rgba(255,215,0,0.2); border-radius: 3px; }

    /* â”€â”€ Request row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .req-row {
      display: grid;
      grid-template-columns: 130px 1fr 90px 48px;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      transition: background 0.15s;
      animation: rowIn 0.35s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .req-row:hover { background: rgba(255,215,0,0.03); }
    .req-row.is-new { background: rgba(255,215,0,0.07); }

    @keyframes rowIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Type + location cell */
    .req-meta { display: flex; flex-direction: column; gap: 3px; min-width: 0; }

    .req-type {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.06em;
      padding: 2px 7px;
      border-radius: 4px;
      width: fit-content;
    }

    .req-location {
      font-size: 12px;
      font-weight: 500;
      color: rgba(255,255,255,0.75);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .req-coords {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      color: rgba(255,255,255,0.25);
    }

    /* Sun bar */
    .sun-bar-wrap { display: flex; align-items: center; gap: 7px; }
    .sun-bar-track {
      flex: 1; height: 3px; border-radius: 99px;
      background: rgba(255,255,255,0.08);
      overflow: hidden;
    }
    .sun-bar-fill {
      height: 100%; border-radius: 99px;
      transition: width 0.6s cubic-bezier(0.4,0,0.2,1);
    }
    .sun-pct {
      font-family: 'Roboto Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      min-width: 30px;
      text-align: right;
    }

    /* Zone chip */
    .zone-chip {
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      color: rgba(255,255,255,0.4);
      background: rgba(255,255,255,0.05);
      border-radius: 4px;
      padding: 2px 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Elapsed */
    .req-time {
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      color: rgba(255,255,255,0.25);
      text-align: right;
    }

    /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .footer {
      background: #0a0a18;
      border-top: 1px solid rgba(255,180,0,0.1);
      padding: 8px 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .footer-text {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      color: rgba(255,255,255,0.2);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .footer-right {
      margin-left: auto;
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      color: rgba(255,215,0,0.3);
      letter-spacing: 0.04em;
    }

    /* â”€â”€ New badge flash on nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .new-badge {
      background: #ef4444;
      color: #fff;
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      font-weight: 700;
      border-radius: 99px;
      padding: 1px 5px;
      min-width: 18px;
      text-align: center;
      line-height: 16px;
      height: 16px;
      animation: badgePop 0.3s cubic-bezier(0.34,1.56,0.64,1);
    }

    @keyframes badgePop {
      from { transform: scale(0.4); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    /* â”€â”€ Scrollbar auto-hide â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .feed { scroll-behavior: smooth; }
  </style>
</head>
<body>

  <!-- â”€â”€ Top nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="nav">
    <div class="nav-brand">
      <span class="nav-sun">â˜€</span>
      TERRASSES SOLEIL
    </div>
    <span id="new-badge" class="new-badge" style="display:none">0</span>
    <div class="nav-dot" style="margin-left:4px"></div>
    <div class="nav-time" id="clock">--:--:--</div>
  </nav>

  <!-- â”€â”€ Tab bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="tabs">
    <div class="tab" onclick="setTab('carte')">
      <span class="tab-icon">ğŸ—º</span>CARTE
    </div>
    <div class="tab" onclick="setTab('top20')">
      <span class="tab-icon">â˜€</span>TOP 20
    </div>
    <div class="tab" onclick="setTab('exposees')">
      <span class="tab-icon">ğŸŒ¤</span>EXPOSÃ‰ES
    </div>
    <div class="tab active" onclick="setTab('live')">
      <span class="tab-icon">ğŸ“¡</span>LIVE
    </div>
  </div>

  <!-- â”€â”€ Stats strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="stats-strip">
    <div class="stat-cell">
      <div class="stat-val" id="stat-total">0</div>
      <div class="stat-label">Total</div>
    </div>
    <div class="stat-cell">
      <div class="stat-val" id="stat-active">0</div>
      <div class="stat-label">Actif</div>
    </div>
    <div class="stat-cell">
      <div class="stat-val" id="stat-rps">0/s</div>
      <div class="stat-label">DÃ©bit</div>
    </div>
    <div class="stat-cell">
      <div class="stat-val" id="stat-sun">â€”%</div>
      <div class="stat-label">â˜€ Moy.</div>
    </div>
  </div>

  <!-- â”€â”€ Type filter bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="type-bar" id="type-bar">
    <!-- filled by JS -->
  </div>

  <!-- â”€â”€ Column header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="col-header">
    <div class="col-h">RequÃªte</div>
    <div class="col-h">Exposition solaire</div>
    <div class="col-h">Zone</div>
    <div class="col-h" style="text-align:right">Ã‚ge</div>
  </div>

  <!-- â”€â”€ Feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="feed" id="feed"></div>

  <!-- â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="footer">
    <div class="nav-dot" style="width:6px;height:6px"></div>
    <span class="footer-text">Flux en direct Â· Paris, Ãle-de-France</span>
    <span class="footer-right">â˜€ terrasses-soleil</span>
  </div>


<script>
// â”€â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ZONES = [
  "Marais","Montmartre","Saint-Germain","Bastille","Oberkampf",
  "RÃ©publique","Nation","Belleville","Pigalle","ChÃ¢telet",
  "OpÃ©ra","Batignolles","Canal St-Martin","Buttes-Chaumont",
  "MÃ©nilmontant","PÃ¨re-Lachaise","Daumesnil","Vincennes",
];

const TERRASSES = [
  "Le Perchoir Marais","CafÃ© de Flore","Les Deux Magots","Brasserie Lipp",
  "Chez Janou","Le Baron Rouge","CafÃ© Charlot","Le ProgrÃ¨s",
  "Rosa Bonheur","Pavillon Puebla","La Rotonde","L'EntrepÃ´t",
  "Le Select","CafÃ© Beaubourg","Chez Prune","Le Comptoir du Relais",
  "CafÃ© de la Paix","Chez Paul","Le Pure CafÃ©","CafÃ© de la Mairie",
];

const TYPES = [
  { key: "TOP 20",   icon: "â˜€",  color: "#ffd700", bg: "rgba(255,215,0,0.12)",  border: "rgba(255,215,0,0.25)" },
  { key: "CARTE",    icon: "ğŸ—º",  color: "#34d399", bg: "rgba(52,211,153,0.12)", border: "rgba(52,211,153,0.25)" },
  { key: "EXPOSÃ‰ES", icon: "ğŸŒ¤",  color: "#60a5fa", bg: "rgba(96,165,250,0.12)", border: "rgba(96,165,250,0.25)" },
  { key: "ANALYSE",  icon: "ğŸ“Š", color: "#c084fc", bg: "rgba(192,132,252,0.12)", border: "rgba(192,132,252,0.25)" },
];

const TYPE_MAP = Object.fromEntries(TYPES.map(t => [t.key, t]));

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
function rnd(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let requests = [];
let total = 0;
let nextId = 1;
let newIds = new Set();
let rpsLog = [];
let activeFilter = null; // null = all
let activeTab = 'live';

// Seed initial rows
for (let i = 0; i < 12; i++) {
  const type = TYPES[i % 4];
  const zone = ZONES[i % ZONES.length];
  requests.push({
    id: nextId++,
    type: type.key,
    zone,
    terrace: type.key === "CARTE" ? pick(TERRASSES) : null,
    sun: rnd(58, 98),
    time: Date.now() - (12 - i) * 12000,
    lat: (48.85 + (Math.random() - 0.5) * 0.12).toFixed(4),
    lng: (2.35 + (Math.random() - 0.5) * 0.15).toFixed(4),
  });
  total++;
}

// â”€â”€â”€ DOM helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const feed = document.getElementById('feed');
const typebar = document.getElementById('type-bar');

function sunColor(v) {
  if (v >= 88) return '#ffd700';
  if (v >= 74) return '#fbbf24';
  return '#fcd34d';
}

function elapsedStr(ts) {
  const s = Math.floor((Date.now() - ts) / 1000);
  if (s < 10) return 'maintenant';
  if (s < 60) return s + 's';
  const m = Math.floor(s / 60);
  if (m < 60) return m + ' min';
  return Math.floor(m / 60) + 'h';
}

function makeRow(req, isNew) {
  const t = TYPE_MAP[req.type];
  const row = document.createElement('div');
  row.className = 'req-row' + (isNew ? ' is-new' : '');
  row.dataset.id = req.id;
  row.dataset.ts = req.time;

  const pct = req.sun;
  const col = sunColor(pct);
  const loc = req.terrace || req.zone;

  row.innerHTML = `
    <div class="req-meta">
      <span class="req-type" style="color:${t.color};background:${t.bg};border:1px solid ${t.border}">
        ${t.icon} ${t.key}
      </span>
      <span class="req-location" title="${loc}">${loc}</span>
      <span class="req-coords">${req.lat}Â°N Â· ${req.lng}Â°E</span>
    </div>
    <div class="sun-bar-wrap">
      <div class="sun-bar-track">
        <div class="sun-bar-fill" style="width:${pct}%;background:linear-gradient(90deg,#fbbf24,${col})"></div>
      </div>
      <span class="sun-pct" style="color:${col}">${pct}%</span>
    </div>
    <div class="zone-chip" title="${req.zone}">${req.zone}</div>
    <div class="req-time" data-ts="${req.time}">${elapsedStr(req.time)}</div>
  `;

  if (isNew) {
    setTimeout(() => row.classList.remove('is-new'), 2500);
  }
  return row;
}

// â”€â”€â”€ Render type bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTypeBar() {
  typebar.innerHTML = '';
  TYPES.forEach(t => {
    const count = requests.filter(r => r.type === t.key).length;
    const cell = document.createElement('div');
    cell.className = 'type-cell' + (activeFilter === t.key ? ' active-filter' : '');
    cell.innerHTML = `
      <div class="type-pill-name" style="color:${t.color}">${t.icon} ${t.key}</div>
      <div class="type-pill-count">${count}</div>
    `;
    cell.onclick = () => {
      activeFilter = activeFilter === t.key ? null : t.key;
      renderAll();
    };
    typebar.appendChild(cell);
  });
}

// â”€â”€â”€ Render full feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  renderTypeBar();
  feed.innerHTML = '';
  const toShow = activeFilter
    ? requests.filter(r => r.type === activeFilter)
    : requests;
  toShow.forEach(req => {
    feed.appendChild(makeRow(req, newIds.has(req.id)));
  });
  updateStats();
}

// â”€â”€â”€ Prepend single row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function prependRow(req) {
  if (activeFilter && req.type !== activeFilter) return;
  const row = makeRow(req, true);
  feed.insertBefore(row, feed.firstChild);
  // Limit DOM rows to 60
  while (feed.children.length > 60) {
    feed.removeChild(feed.lastChild);
  }
}

// â”€â”€â”€ Stats update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats() {
  document.getElementById('stat-total').textContent = total.toLocaleString('fr-FR');
  document.getElementById('stat-active').textContent = requests.length;

  const now = Date.now();
  rpsLog = rpsLog.filter(t => now - t < 60000);
  const rps = (rpsLog.length / 60).toFixed(1);
  document.getElementById('stat-rps').textContent = rps + '/s';

  if (requests.length) {
    const avg = Math.round(requests.reduce((s, r) => s + r.sun, 0) / requests.length);
    document.getElementById('stat-sun').textContent = avg + '%';
  }
}

// â”€â”€â”€ Elapsed ticker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setInterval(() => {
  feed.querySelectorAll('.req-time[data-ts]').forEach(el => {
    el.textContent = elapsedStr(+el.dataset.ts);
  });
}, 15000);

// â”€â”€â”€ Clock â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateClock() {
  document.getElementById('clock').textContent =
    new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
}
setInterval(updateClock, 1000);
updateClock();

// â”€â”€â”€ New request generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let newCount = 0;
let badgeTimer = null;

function addRequest() {
  const type = pick(TYPES);
  const zone = pick(ZONES);
  const req = {
    id: nextId++,
    type: type.key,
    zone,
    terrace: type.key === "CARTE" ? pick(TERRASSES) : null,
    sun: rnd(58, 98),
    time: Date.now(),
    lat: (48.85 + (Math.random() - 0.5) * 0.12).toFixed(4),
    lng: (2.35 + (Math.random() - 0.5) * 0.15).toFixed(4),
  };

  requests.unshift(req);
  if (requests.length > 50) requests.pop();
  total++;
  newIds.add(req.id);
  rpsLog.push(Date.now());

  setTimeout(() => newIds.delete(req.id), 2500);

  // Update type bar counts
  renderTypeBar();

  // Prepend row to feed
  prependRow(req);
  updateStats();

  // Badge if not on live tab
  if (activeTab !== 'live') {
    newCount++;
    const badge = document.getElementById('new-badge');
    badge.style.display = 'inline-block';
    badge.textContent = newCount > 99 ? '99+' : newCount;
  }

  // Schedule next
  setTimeout(addRequest, rnd(2000, 5500));
}

// â”€â”€â”€ Tab switcher â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setTab(tab) {
  activeTab = tab;
  document.querySelectorAll('.tab').forEach((el, i) => {
    const tabs = ['carte','top20','exposees','live'];
    el.classList.toggle('active', tabs[i] === tab);
  });

  if (tab === 'live') {
    newCount = 0;
    const badge = document.getElementById('new-badge');
    badge.style.display = 'none';
    badge.textContent = '0';
    renderAll();
  } else {
    // Simulate switching back to map/list view with a placeholder
    feed.innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;
                  height:100%;padding:40px;text-align:center;color:rgba(255,255,255,0.2);">
        <div style="font-size:48px;margin-bottom:16px">${tab==='carte'?'ğŸ—º':tab==='top20'?'â˜€':'ğŸŒ¤'}</div>
        <div style="font-family:'Oswald',sans-serif;font-size:18px;letter-spacing:0.1em;margin-bottom:8px">
          ${tab.toUpperCase()} VIEW
        </div>
        <div style="font-family:'Roboto Mono',monospace;font-size:11px">
          IntÃ©grez votre vue existante ici
        </div>
      </div>`;
  }
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderAll();
setTimeout(addRequest, rnd(2000, 4000));
</script>
</body>
</html>
